---
title: "Merge"
output: html_notebook
---

```{r}
library(tidyverse)
library(reshape2)
```


```{r}
olympics <- read.csv(
  url("https://raw.githubusercontent.com/nickbrowen/STAT-414-Project/master/Track%20Results.csv"))
pop <- read.csv("population.csv")
gdp <- read.csv("gdp.csv")
codes <- read.csv("country-codes.csv")
```

```{r}
head(olympics)
head(pop)
head(gdp)
head(codes)
```

```{r}
codes
```





goal: long data format
Geo   Year    GDP
---------------------
Afg   1800    3280000
Afg   1801    3280000
...

```{r}
# Convert gdp and pop data into long format
pop_long <- pop %>% 
  melt() %>% 
  mutate(year = variable %>% substr(2,5) %>% as.numeric()) %>%
  select(geo, year, value)

colnames(pop_long) <- c("country", "year", "population")

gdp_long <- gdp %>% 
  melt() %>%
  mutate(year = variable %>% substr(2,5) %>% as.numeric()) %>%
  select(geo, value, year)

colnames(gdp_long) <- c("country", "gdp", "year")

# Join the two data sets
country_data <- full_join(gdp_long, pop_long, by=c("country", "year")) %>%
  select(year, country, gdp, population)
```


```{r}
colnames(codes) <- c("x", "country", "code")
codes <- codes %>% select(code, country)
codes$code <- codes$code %>% as.character()
codes$country <- codes$country %>% as.character()
```


USA
GBR
```{r}
codes
```


do a join on x=country data, y=codes to get the country codes and keep all observations in x

```{r}
country_codes <- full_join(country_data, codes, by="country")

country_codes %>% filter(year == 1801) %>% filter(is.na(code)) %>% select(year, country)

codes %>% filter(country == "Bolivia")
```








Now merge country_codes with olympics.

goal: keep each row in olympics, include that athlete's country, gdp, population

gender  event location  year  medal name  nationality result  gdp, population

```{r}
colnames(olympics) <- c("gender", "event", "hostCity", "year", 
                        "medal", "name", "code", "result", "X")
olympics <- olympics %>% select(name, code, year, event, medal, result, hostCity, gender)
```

```{r}
data <- full_join(olympics, country_codes, by=c("year", "code"))
```
Events to filter out:

Heptathlon Women
Decathlon Men
Discus Throw Men
Hammer Throw Men
High Jump Men
Javelin Throw Men
Long Jump Men
Pole Vault Men
Shot Put Men
Triple Jump Men
Discus Throw Women
Hammer Throw Women
High Jump Women
Javelin Throw Women
Long Jump Women
 Pole Vault Women
 Shot Put Women
 Triple Jump Women
```{r}
data
```

```{r}
drop_events <- c("Heptathlon Women", "Decathlon Men", "Discus Throw Men", "Hammer Throw Men", "High Jump Men", "Javelin Throw Men", 
                 "Long Jump Men", "Pole Vault Men", "Shot Put Men", "Triple Jump Men", "Discus Throw Women", "Hammer Throw Women", 
                 "High Jump Women", "Javelin Throw Women", "Long Jump Women", "Pole Vault Women", "Shot Put Women", "Triple Jump Women")

'%!in%' <- function(x,y)!('%in%'(x,y))

track_data <- data %>% filter(event %!in% drop_events) %>%
  filter(!is.na(event))
```


```{r}
track_data$name <- track_data$name %>% tolower()
track_data
```


```{r}
medalists <- read.csv("track_medalists.csv")
medalists$Name <- medalists$Name %>% tolower()
```

```{r}
medalists <- medalists %>% mutate(
  Medal = case_when(Medal == "Gold" ~ "G",
            Medal == "Silver" ~ "S",
            Medal == "Bronze" ~ "B")
)

```


```{r}
medalists
```
```{r}
track_data
```
year, event, medal

```{r}
track_data %>% select(event) %>% unique()
```


Athletics Men's 1,500 metres               
Athletics Men's 10,000 metres              
Athletics Men's Marathon        
Athletics Women's 5,000 metres             
Athletics Men's 4 x 400 metres Relay
Athletics Men's 100 metres                 
Athletics Men's 4 x 100 metres Relay        
Athletics Men's 400 metres Hurdles
Athletics Women's 4 x 400 metres Relay     
Athletics Women's 4 x 100 metres Relay     
Athletics Women's 100 metres Hurdles
Athletics Men's Cross-Country, Team        
Athletics Men's 10 kilometres Walk
Athletics Men's 3,000 metres Steeplechase  
Athletics Women's 400 metres
Athletics Men's 800 metres                 
[27] Athletics Men's Pole Vault                  Athletics Women's Marathon                 
[29] Athletics Men's 110 metres Hurdles          Athletics Men's Cross-Country, Individual  
[31] Athletics Men's Shot Put                    Athletics Men's 20 kilometres Walk         
[33] Athletics Women's Discus Throw              Athletics Women's 400 metres Hurdles       
[35] Athletics Men's 5,000 metres                Athletics Men's 200 metres                 
[37] Athletics Men's 50 kilometres Walk          Athletics Women's 100 metres               
[39] Athletics Women's 3,000 metres Steeplechase Athletics Women's High Jump                
[41] Athletics Men's Decathlon                   Athletics Women's 10,000 metres            
[43] Athletics Men's 400 metres                  Athletics Men's Javelin Throw              
[45] Athletics Men's 3,000 metres, Team          Athletics Women's 1,500 metres             
[47] Athletics Men's Standing Triple Jump        Athletics Women's Heptathlon               
[49] Athletics Women's 800 metres                Athletics Men's 4,000 metres Steeplechase  
[51] Athletics Men's 5,000 metres, Team          Athletics Men's Pentathlon                 
[53] Athletics Women's Pentathlon                Athletics Women's 200 metres               
[55] Athletics Women's 80 metres Hurdles         Athletics Men's 1,600 metres Medley Relay  
[57] Athletics Men's 1,500 metres Walk           Athletics Men's 3 mile, Team               
[59] Athletics Men's 200 metres Hurdles          Athletics Women's 3,000 metres             
[61] Athletics Men's 2,500 metres Steeplechase   Athletics Women's 10 kilometres Walk       
[63] Athletics Men's 4 mile, Team                Athletics Women's Hammer Throw             
[65] Athletics Men's 5 mile                      Athletics Men's 2,590 metres Steeplechase  
[67] Athletics Men's 56-pound Weight Throw       Athletics Women's Triple Jump              
[69] Athletics Men's Stone Throw                 Athletics Men's Javelin Throw, Freestyle   
[71] Athletics Women's Pole Vault                Athletics Men's 3,200 metres Steeplechase  
[73] Athletics Men's 3,000 metres Walk           Athletics Men's Discus Throw, Greek Style  
[75] Athletics Women's 20 kilometres Walk        Athletics Men's All-Around Championship    
[77] Athletics Men's 60 metres                   Athletics Men's 3,500 metres Walk          
[79] Athletics Men's 10 mile Walk                Athletics Men's Pentathlon (Ancient)       
[81] Athletics Men's Discus Throw, Both Hands    Athletics Men's Shot Put, Both Hands       
[83] Athletics Men's Javelin Throw, Both Hands  



```{r}
#track_data %>% write.csv("track_data.csv")
```












